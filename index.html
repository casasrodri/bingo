<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bingo Musical</title>
    <style>
        :root {
            --bg: #0f172a;
            --glass: rgba(255, 255, 255, 0.06);
            --accent1: #ff7ab6;
            --accent2: #7afcff;
            --accent3: #ffd36b;
            --accent4: #8dff7a;
            --player-h: 45px;
            --controls-h: 45px;
            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto;
        }

        html,
        body {
            margin: 0;
            height: 100%;
            background: linear-gradient(180deg, var(--bg), #071028 80%);
            color: #fff;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .app {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .hidden {
            display: none !important;
        }

        #block {
            display: block;
        }

        #playerDisplay {
            height: var(--player-h);
            line-height: var(--player-h);
            text-align: center;
            font-size: 1.4rem;
            font-weight: 800;
            background: #007bff;
            color: #fff;
            margin: 0;
            box-sizing: border-box;
        }

        #startBtn {
            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto;
            width: 100%;
            height: 40px;
            text-align: center;
            font-size: 1.10rem;
            font-weight: 400;
            background: #007bff;
            color: #fff;
            margin: 0;
            border-radius: 8px;
        }

        .board {
            height: calc(92vh - var(--player-h));
            width: 100vw;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 6px;
            padding: 8px;
            box-sizing: border-box;
        }

        /* Centrar contenido cuando mostramos el mensaje del ganador */
        .centered {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: calc(100vh - var(--player-h));
            width: 100vw;
            padding: 0 18px;
            box-sizing: border-box;
            font-size: 1.4rem;
            text-align: center !important;
        }

        .cell {
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-weight: 700;
            font-size: clamp(1.1rem, 2.6vw, 1.1rem);
            padding: 8px;
            cursor: pointer;
            user-select: none;
            transition: transform .12s ease, box-shadow .12s ease;
            box-shadow: 0 6px 18px rgba(2, 6, 23, 0.45), inset 0 -6px 18px rgba(255, 255, 255, 0.02);
        }

        .cell:active {
            transform: translateY(2px) scale(.995);
        }

        .marked {
            opacity: .45;
            text-decoration: line-through;
            filter: grayscale(.2);
        }

        .song-title {
            font-weight: 700;
        }

        .song-artist {
            font-size: 0.8em;
            font-style: italic;
            opacity: 0.9;
        }

        .c1 {
            background: linear-gradient(135deg, var(--accent1), #ffb3e1);
        }

        .c2 {
            background: linear-gradient(135deg, var(--accent2), #9ff7ff);
            color: #082127;
        }

        .c3 {
            background: linear-gradient(135deg, var(--accent3), #ffe6a8);
            color: #2a1600;
        }

        .c4 {
            background: linear-gradient(135deg, var(--accent4), #caffb3);
            color: #06380a;
        }

        #controls {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            height: var(--controls-h);
            background: rgba(255, 255, 255, 0.04);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
        }

        #controls button {
            flex: 1;
            border: none;
            border-radius: 0;
            background: rgba(0, 123, 255, 0.95);
            color: #fff;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.08s;
        }

        #controls button:active {
            transform: scale(.97);
        }

        .modal {
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, rgba(2, 6, 23, 0.65), rgba(2, 6, 23, 0.85));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 18px;
        }

        .card {
            background: #08142a;
            padding: 18px;
            border-radius: 14px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 8px 40px rgba(0, 0, 0, .6);
        }

        .input {
            width: 120px;
            padding: 12px;
            letter-spacing: 8px;
            font-size: 1.5rem;
            text-align: center;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.04);
            color: #fff;
            margin: 1rem auto;
            font-weight: 600;
            transition: border-color 0.2s ease;
        }

        .input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .input::placeholder {
            letter-spacing: 0;
            font-size: 0.9rem;
            font-weight: normal;
        }

        #cancionesGanador {
            margin-top: 1rem;
            align-self: flex-start;
            padding-left: 2rem;
        }

        #cancionesGanador ol {
            text-align: left;
            margin: 0;
            padding-left: 2rem;
        }

        #cancionesGanador li {
            margin: 0.5rem 0;
            font-size: 1.1rem;
        }

        .confetti {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
        }

        @keyframes fall {
            0% {
                transform: translateY(-120vh) rotate(0)
            }

            100% {
                transform: translateY(120vh) rotate(720deg)
            }
        }

        .confetti span {
            position: absolute;
            width: 10px;
            height: 16px;
            display: block;
            opacity: .95;
            border-radius: 2px;
            animation: fall 2.4s linear infinite;
        }
    </style>
</head>

<body>
    <div class="app">
        <div id="playerDisplay">üéâ Boda Rodri & Pauli</div>
        <div class="board" id="board"></div>
        <!-- <div id="controls">
            <button id="regenerate">üÜï Nuevo</button>
            <button id="shuffle">üîÄ Barajar</button>
            <button id="help">üÜò Ayuda</button>
        </div> -->
        <div id="seccGanador" class="hidden">
            üèÜ GANADOR
            <h4 id="nombreGanador"></h4>
            <ol id="cancionesGanador"></ol>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="card" style="text-align: center;">
            <h2>¬øListo para jugar?</h2>
            <p>Ingres√° tu c√≥digo de 3 n√∫meros</p>
            <input id="playerName" class="input" placeholder="000" maxlength="3" inputmode="numeric" pattern="[0-9]*"
                autocomplete="off" />
            <!-- <div style="display:flex;gap:8px;justify-content:center">
                <button id="startBtn">Comenzar</button>
                <button id="skipBtn">Sin nombre</button>
            </div> -->
        </div>
    </div>

    <div class="modal" id="modalGanador" style="display:none">
        <div class="card">
            <h2>¬°Felicitaciones!</h2>
            <p>Ganaste el juego.</p>
            <p>Acercate a reclamar tu premio!</p>
        </div>
    </div>

    <div class="confetti" id="confetti"></div>

    <script>
        const paginaGanador = new URLSearchParams(window.location.search).get('ganador') !== null;
        console.log({ paginaGanador })

        const SONGS = {
            A: { title: 'Como Me Gusta La Noche', artist: 'Nene Malo' },
            B: { title: 'Soy Soltero', artist: 'El Dipy' },
            C: { title: 'La Mano de Dios', artist: 'Rodrigo' },
            D: { title: 'La Triple T', artist: 'Tini' },
            E: { title: 'Llamado de Emergencia', artist: 'Daddy Yankee' },
            F: { title: 'Intento', artist: 'Ulises Bueno' },
            G: { title: 'Noche Loca', artist: 'Rombai Ft. Marama' },
            H: { title: 'Bomb√≥n Asesino', artist: 'Los Palmeras' },
            I: { title: 'Cuando Calienta el Sol', artist: 'Luis Miguel' },
            J: { title: 'Mentirosa', artist: 'R√°faga' },
            K: { title: 'No me Arrepiento de este Amor', artist: 'Gilda' },
            L: { title: 'Coraz√≥n Mentiroso', artist: 'Karina' },
            M: { title: 'Procura', artist: 'Chichi Peralta' },
        };

        const PLAYERS = {
            '550': { alias: 'Abu Nil', combinacion: 'BCDEHJKLM' },
            '089': { alias: 'Adri Banega', combinacion: 'ABCDFGJLM' },
            '181': { alias: 'Agus Cardozo', combinacion: 'ABCEHJKLM' },
            '400': { alias: 'Agus Garayo', combinacion: 'ACDFGIKLM' },
            '527': { alias: 'Alan Bass', combinacion: 'BCDEFIJKM' },
            '389': { alias: 'Aldi', combinacion: 'ACDFGHIJM' },
            '018': { alias: 'Ale', combinacion: 'ABCDEFHIL' },
            '339': { alias: 'Ali D√°vila', combinacion: 'ACDEFGHKM' },
            '660': { alias: 'Amiga Anita', combinacion: 'BFGHIJKLM' },
            '103': { alias: 'Andre Spampinato', combinacion: 'ABCDFIJLM' },
            '461': { alias: 'Andre Abramo', combinacion: 'ADEFGIJKL' },
            '577': { alias: 'Andre Banega', combinacion: 'BCDGHJKLM' },
            '425': { alias: 'Andr√©s', combinacion: 'ACEFGIJKL' },
            '561': { alias: 'Anita Gonz√°lez', combinacion: 'BCDFGHKLM' },
            '023': { alias: '‚öì Anita Bossio (Chuky)', combinacion: 'ABCDEFHKL', mensaje: '√âxitos Capitana ‚öì' },
            '608': { alias: 'Anita Boguera', combinacion: 'BCFGHIJKL' },
            '352': { alias: 'Aure', combinacion: 'ACDEFHIJL' },
            '414': { alias: '‚öì Bebito', combinacion: 'ACDHIJKLM', mensaje: '√âxitos Capit√°n ‚öì' },
            '313': { alias: 'Belu S√°nchez', combinacion: 'ABEFHIKLM' },
            '069': { alias: 'Belu  Benoyo', combinacion: 'ABCDEIKLM' },
            '064': { alias: 'Vetto', combinacion: 'ABCDEHJLM' },
            '637': { alias: '√ëa√±i / Cu√±is', combinacion: 'BDEGHIJKL' },
            '406': { alias: 'Caro Videla', combinacion: 'ACDFHJKLM' },
            '184': { alias: 'Ceci S√°nchez', combinacion: 'ABCFGHIJL' },
            '388': { alias: 'Ceci Galante', combinacion: 'ACDFGHIJL' },
            '075': { alias: '‚öì Chacho', combinacion: 'ABCDFGHJK', mensaje: '√âxitos Capit√°n ‚öì' },
            '627': { alias: 'Chichi', combinacion: 'BDEFGIJKM' },
            '081': { alias: 'Amigo Turco', combinacion: 'ABCDFGIJK' },
            '616': { alias: 'Coti', combinacion: 'BDEFGHIJK' },
            '270': { alias: 'Dorita', combinacion: 'ABDFGHIKL' },
            '211': { alias: 'Eli', combinacion: 'ABDEFGHIJ' },
            '290': { alias: 'Elo', combinacion: 'ABDGHIJLM' },
            '027': { alias: 'Emi', combinacion: 'ABCDEFIJL' },
            '501': { alias: 'Enzo', combinacion: 'BCDEFGHJL' },
            '462': { alias: 'Espe', combinacion: 'ADEFGIJKM' },
            '496': { alias: 'Esther', combinacion: 'BCDEFGHIJ' },
            '563': { alias: 'Eugish', combinacion: 'BCDFGIJKM' },
            '123': { alias: 'Eushi', combinacion: 'ABCDHIJLM' },
            '247': { alias: 'Fabri', combinacion: 'ABDEGHIJL' },
            '190': { alias: 'Fede Caminal', combinacion: 'ABCFGHJKM' },
            '085': { alias: '‚öì Fede Gordillo', combinacion: 'ABCDFGIKM', mensaje: '√âxitos Capit√°n ‚öì' },
            '048': { alias: 'Fer', combinacion: 'ABCDEGIJM' },
            '022': { alias: '‚öì Flor Cabello', combinacion: 'ABCDEFHJM', mensaje: '√âxitos Capitana ‚öì' },
            '171': { alias: 'Flor Milanesio', combinacion: 'ABCEGHKLM' },
            '585': { alias: 'Flor Torres', combinacion: 'BCEFGHILM' },
            '484': { alias: 'Gabi Nieto', combinacion: 'ADFGIJKLM' },
            '424': { alias: 'Gabi Caceres', combinacion: 'ACEFGHKLM' },
            '652': { alias: 'Gabi Llorens', combinacion: 'BEFGHIJKL' },
            '183': { alias: 'Gari', combinacion: 'ABCFGHIJK' },
            '357': { alias: 'Gime', combinacion: 'ACDEFHJKL' },
            '261': { alias: 'Gino', combinacion: 'ABDEHIJKL' },
            '452': { alias: 'Gonza', combinacion: 'ADEFGHIJL' },
            '692': { alias: 'Gra', combinacion: 'CDFGHIKLM' },
            '234': { alias: 'Guada L√≥pez', combinacion: 'ABDEFHIKL' },
            '391': { alias: 'Guada Llorens', combinacion: 'ACDFGHIKM' },
            '314': { alias: 'Gusti Brunetto', combinacion: 'ABEFHJKLM' },
            '345': { alias: 'Gusti Godoy', combinacion: 'ACDEFGIKM' },
            '065': { alias: 'H√©ctor', combinacion: 'ABCDEHKLM' },
            '112': { alias: 'Helguis', combinacion: 'ABCDGHJKL' },
            '177': { alias: 'Iri', combinacion: 'ABCEHIJKL' },
            '451': { alias: 'Muchacha', combinacion: 'ADEFGHIJK' },
            '077': { alias: '‚öì Javi', combinacion: 'ABCDFGHJM', mensaje: '√âxitos Capit√°n ‚öì' },
            '565': { alias: 'Jor', combinacion: 'BCDFGIKLM' },
            '102': { alias: 'Juli L√≥pez', combinacion: 'ABCDFIJKM' },
            '200': { alias: 'Juli Vila', combinacion: 'ABCFHIJLM' },
            '341': { alias: 'Kari', combinacion: 'ACDEFGIJK' },
            '481': { alias: 'Kevin / Brian', combinacion: 'ADFGHIJLM' },
            '623': { alias: 'Lau', combinacion: 'BDEFGHJKM' },
            '145': { alias: 'Leo', combinacion: 'ABCEFGJLM' },
            '342': { alias: 'Luci', combinacion: 'ACDEFGIJL' },
            '306': { alias: 'Lu Sosa', combinacion: 'ABEFGIJKM' },
            '387': { alias: 'Luca', combinacion: 'ACDFGHIJK' },
            '214': { alias: 'Barba', combinacion: 'ABDEFGHIM' },
            '626': { alias: 'Lucas', combinacion: 'BDEFGIJKL' },
            '148': { alias: 'Luigi', combinacion: 'ABCEFHIJL', mensaje: '¬°Oh por Dios! ¬øQu√© es un QR? ü§Ø' },
            '666': { alias: 'Lumi', combinacion: 'CDEFGHILM' },
            '253': { alias: 'Male', combinacion: 'ABDEGHJKM' },
            '393': { alias: 'Mar', combinacion: 'ACDFGHJKL' },
            '025': { alias: '‚öì Marce Castro', combinacion: 'ABCDEFHLM', mensaje: '√âxitos Capit√°n ‚öì' },
            '606': { alias: 'Marcio', combinacion: 'BCEGIJKLM' },
            '431': { alias: 'Negro Marian', combinacion: 'ACEFHIJKM' },
            '658': { alias: 'Marian', combinacion: 'BEFHIJKLM' },
            '536': { alias: 'Maru Ramos', combinacion: 'BCDEGHILM' },
            '615': { alias: 'Marti Alvelo', combinacion: 'BCGHIJKLM' },
            '006': { alias: 'Marti Blady', combinacion: 'ABCDEFGIJ' },
            '169': { alias: 'Maru  Badal√°', combinacion: 'ABCEGHJKM' },
            '398': { alias: 'Mateo', combinacion: 'ACDFGIJKM' },
            '079': { alias: 'Mati Escoda', combinacion: 'ABCDFGHKM' },
            '164': { alias: 'Mati Talarico', combinacion: 'ABCEGHIJM' },
            '062': { alias: 'Mati Martinez', combinacion: 'ABCDEHJKL' },
            '477': { alias: 'Mely', combinacion: 'ADEGIJKLM' },
            '696': { alias: 'Mica Banno', combinacion: 'CDGHIJKLM' },
            '566': { alias: 'Mica Puebla', combinacion: 'BCDFGJKLM' },
            '378': { alias: 'Moni Canavese', combinacion: 'ACDEGIJLM' },
            '316': { alias: 'Moni V√©lez', combinacion: 'ABEGHIJKL' },
            '327': { alias: 'Moni Garbarino', combinacion: 'ABFGHJKLM' },
            '258': { alias: 'Myri', combinacion: 'ABDEGIJLM' },
            '135': { alias: 'Nacho', combinacion: 'ABCEFGHKM' },
            '037': { alias: 'Nati', combinacion: 'ABCDEGHIK' },
            '668': { alias: 'Nativity', combinacion: 'CDEFGHJKM' },
            '420': { alias: 'Nelson', combinacion: 'ACEFGHILM' },
            '296': { alias: 'Norwin', combinacion: 'ABEFGHIJL' },
            '351': { alias: 'Dolo', combinacion: 'ACDEFHIJK' },
            '130': { alias: 'Flor Arag√≥n', combinacion: 'ABCEFGHIM' },
            '426': { alias: 'Pancho', combinacion: 'ACEFGIJKM' },
            '330': { alias: 'Pao', combinacion: 'ABGHIJKLM' },
            '220': { alias: 'Sergio Molina', combinacion: 'ABDEFGHLM' },
            '363': { alias: 'Marce Encina', combinacion: 'ACDEFIJLM' },
            '416': { alias: 'David', combinacion: 'ACEFGHIJL' },
            '246': { alias: '‚öì Pili', combinacion: 'ABDEGHIJK', mensaje: '√âxitos Capitana ‚öì' },
            '554': { alias: 'Rochi', combinacion: 'BCDFGHIJM' },
            '203': { alias: 'Romi', combinacion: 'ABCFIJKLM' },
            '685': { alias: 'Roy', combinacion: 'CDEGHIKLM' },
            '592': { alias: '‚öì Rubens', combinacion: 'BCEFGIJLM', mensaje: '√âxitos Capit√°n ‚öì' },
            '421': { alias: 'Sabri', combinacion: 'ACEFGHJKL' },
            '480': { alias: 'Sil', combinacion: 'ADFGHIJKM' },
            '328': { alias: 'Sill', combinacion: 'ABFGIJKLM' },
            '385': { alias: 'Silvita', combinacion: 'ACDEHJKLM' },
            '157': { alias: 'Sol', combinacion: 'ABCEFIJKL' },
            '158': { alias: 'Fran', combinacion: 'ABCEFIJKM' },
            '007': { alias: 'Teo', combinacion: 'ABCDEFGIK' },
            '360': { alias: 'Mirtha', combinacion: 'ACDEFHKLM' },
            '651': { alias: 'Topo', combinacion: 'BDGHIJKLM' },
            '045': { alias: 'Turco', combinacion: 'ABCDEGHLM' },
            '248': { alias: 'Vale', combinacion: 'ABDEGHIJM' },
            '231': { alias: 'Valen', combinacion: 'ABDEFHIJK' },
            '613': { alias: 'Vero V√©lez', combinacion: 'BCFGIJKLM' },
            '146': { alias: 'Vero Maldonado', combinacion: 'ABCEFGKLM' },
            '437': { alias: 'Vero Rueda', combinacion: 'ACEGHIJKM' },
            '586': { alias: 'Vir Ruatta', combinacion: 'BCEFGHJKL' },
            '520': { alias: '‚öì Vir Savanco', combinacion: 'BCDEFHIKM', mensaje: '√âxitos Capitana ‚öì' },
            '170': { alias: 'Vivi', combinacion: 'ABCEGHJLM' },
            '210': { alias: 'Walter Alcorta', combinacion: 'ABCHIJKLM' },
            '143': { alias: 'Yami', combinacion: 'ABCEFGJKL' },

            // Usuarios sin nombre
            '700': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'CEFGHIKLM' },
            '701': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'CEFGHJKLM' },
            '702': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'CEFGIJKLM' },
            '703': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'CEFHIJKLM' },
            '704': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'CEGHIJKLM' },
            '705': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'CFGHIJKLM' },
            '706': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFGHIJKL' },
            '707': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFGHIJKM' },
            '708': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFGHIJLM' },
            '709': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFGHIKLM' },
            '710': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFGHJKLM' },
            '711': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFGIJKLM' },
            '712': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEFHIJKLM' },
            '713': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DEGHIJKLM' },
            '714': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'DFGHIJKLM' },
            '715': { alias: 'üéâ Boda Rodri & Pauli', combinacion: 'EFGHIJKLM' },
        }

        const boardEl = document.getElementById('board');
        const modal = document.getElementById('modal');
        const modalGanador = document.getElementById('modalGanador');
        const nameInput = document.getElementById('playerName');
        const startBtn = document.getElementById('startBtn');

        // Validaci√≥n para solo permitir n√∫meros
        nameInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 3);
        });
        const skipBtn = document.getElementById('skipBtn');
        const confetti = document.getElementById('confetti');
        const seccGanador = document.getElementById('seccGanador');
        const nombreGanadorEl = document.getElementById('nombreGanador');
        const cancionesGanadorEl = document.getElementById('cancionesGanador');
        let cells = [];


        // Llamada a API para obtener canciones
        // async function crearPartida2(nombreJugador) {
        //     luigi(nombreJugador);

        //     try {
        //         const response = await fetch(`https://script.google.com/macros/s/AKfycbzhiuRvIDNROEnvHCf_B_ygatiHDisHeK8RanBV1uMmCrrCb4Z5HxQ740-wUAZ0kwcm/exec?endpoint=register&nombre=${nombreJugador}`);
        //         const data = await response.json();
        //         console.log('Canciones obtenidas de la API:', data);
        //         return data.partida;

        //     } catch (error) {
        //         console.error('Error al obtener canciones:', error);
        //     }
        // }


        function desordenarArray(array) {
            if (!Array.isArray(array)) return [];

            for (let i = array.length - 1; i > 0; i--) {
                // Genera un √≠ndice aleatorio entre 0 e i
                const j = Math.floor(Math.random() * (i + 1));
                // Intercambia los elementos en las posiciones i y j
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }


        function crearPartida(codigoJugador) {
            const jugador = PLAYERS[codigoJugador];

            if (!jugador) {
                alert('C√≥digo de jugador no v√°lido. Por favor, verifica tu c√≥digo.');
                return null;
            }

            if (jugador.mensaje) {
                alert(jugador.mensaje);
            }

            const listaCanciones = jugador.combinacion.split('').map(letter => SONGS[letter]);
            jugador.canciones = desordenarArray(listaCanciones);

            document.getElementById('playerDisplay').textContent = jugador.alias || 'üéâ Boda Rodri & Pauli';

            return jugador;
        }

        function pickN(arr, n) {
            let c = [...arr], o = [];
            for (let i = 0; i < n && c.length; i++) {
                let r = Math.floor(Math.random() * c.length);
                o.push(c.splice(r, 1)[0]);
            }
            return o;
        }

        function buildBoard(jugador) {
            // Cargando centrado horizontal y verticalmente
            // boardEl.classList.toggle('board');
            // boardEl.classList.toggle('centered');
            // boardEl.innerHTML = 'üïó Cargando...';

            // boardEl.classList.toggle('centered');
            // boardEl.classList.toggle('board');
            cells = jugador.canciones.map(t => ({ ...t, marked: false }));
            render();
        }

        function render() {
            boardEl.innerHTML = '';
            const colors = ['c1', 'c2', 'c3', 'c4'];
            for (let i = 0; i < 9; i++) {
                const c = cells[i];
                const d = document.createElement('div');
                d.className = 'cell ' + colors[i % 4];
                d.innerHTML = `<div class="song-title">${c?.title || ''}</div>
                               <div class="song-artist">${c?.artist || ''}</div>`;
                if (c.marked) d.classList.add('marked');
                d.dataset.i = i;
                d.onclick = toggle;
                boardEl.appendChild(d);
            }
        }

        function toggle() {
            let i = +this.dataset.i;
            cells[i].marked = !cells[i].marked;
            render();
            check();
        }

        function check() {
            const allMarked = cells.every(c => c.marked);
            if (allMarked) celebrate();
        }

        function celebrate() {
            spawnConfetti(100);
            modalGanador.style.display = 'block';
        }

        function spawnConfetti(n) {
            confetti.innerHTML = '';
            const colors = ['#ff7ab6', '#7afcff', '#ffd36b', '#8dff7a', '#9b7bff', '#ff9b7b'];
            for (let i = 0; i < n; i++) {
                let s = document.createElement('span');
                s.style.left = Math.random() * 100 + '%';
                s.style.top = (-10 - Math.random() * 20) + '%';
                s.style.background = colors[Math.floor(Math.random() * colors.length)];
                s.style.animationDelay = (Math.random() * 0.5) + 's';
                s.style.animationDuration = (1.9 + Math.random()) + 's';
                confetti.appendChild(s);
                setTimeout(() => s.remove(), 8000);
            }
        }

        // function setPlayerName(name) {
        //     document.getElementById('playerDisplay').textContent = name || 'Nombre del jugador';
        // }



        function iniciarJuego() {
            const codigo = nameInput.value;
            if (codigo.length !== 3) return;

            jugador = crearPartida(codigo);
            if (!jugador) {
                nameInput.value = '';
                nameInput.focus();
                return false;
            };

            modal.style.display = 'none';
            console.log({ jugador });
            buildBoard(jugador);
        }

        // Auto-inicio cuando hay 3 n√∫meros
        nameInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 3);

            // Si tiene exactamente 3 n√∫meros, iniciar
            if (e.target.value.length === 3) {
                iniciarJuego();
            }
        });

        startBtn.onclick = iniciarJuego;


        window.onload = () => {
            setTimeout(async () => {
                if (paginaGanador) {
                    modal.style.display = 'none';
                    boardEl.classList.toggle('board');

                    seccGanador.classList.toggle('centered');
                    seccGanador.classList.toggle('hidden');

                    try {
                        const res = await fetch('https://script.google.com/macros/s/AKfycbzhiuRvIDNROEnvHCf_B_ygatiHDisHeK8RanBV1uMmCrrCb4Z5HxQ740-wUAZ0kwcm/exec?endpoint=winner');
                        const data = await res.json();

                        nombreGanadorEl.textContent = data.ganador.usuario || 'Desconocido';
                        cancionesGanadorEl.innerHTML = '';
                        data.ganador.canciones.forEach(cancion => {
                            const li = document.createElement('li');
                            li.textContent = `${cancion.title} - ${cancion.artist}`;
                            cancionesGanadorEl.appendChild(li);
                        });

                    } catch (error) {
                        console.error('Error al mostrar el ganador:', error);
                    }
                } else {
                    modal.style.display = 'flex';
                    nameInput.focus();
                }
            }, 300);
        };
    </script>
</body>

</html>
